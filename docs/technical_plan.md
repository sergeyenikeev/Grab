# Технический план MVP

## 1) Источники и реалистичная автоматизация
- Gmail: официальный Gmail API (OAuth) — автоматизируется.
- Mail.ru / Yandex Mail: IMAP (app-password) — автоматизируется.
- Ozon / Wildberries / Яндекс Маркет / Мегамаркет / DNS / Ашан / Aliexpress:
  - в MVP основной канал — письма подтверждений/чеков/уведомлений;
  - direct API/выгрузки/личные кабинеты — как расширение после стабилизации email-контура.

## 2) Каналы получения данных
- Приоритет (по безопасности/легальности):
  1. Официальные API (Gmail реализован, marketplace API — по мере добавления).
  2. Официальные экспорты из ЛК (будет подключаться по каждому сервису отдельно).
  3. Универсальный email-ingest (реализован в MVP).
  4. Browser automation (Playwright) только интерактивно и без обхода антибот-систем.
  5. Любой способ получения информации

## 3) Что уже покрыто MVP
- Синхронизация email из Gmail API + IMAP.
- Фильтрация писем по ключевым словам и дате.
- Парсеры шаблонов Ozon/WB/Яндекс Маркет + fallback.
- Идемпотентный upsert в SQLite.
- Хранение сырья (`raw_messages`), `sync_runs`, `audit_log`.
- Скачивание вложений и медиа-ссылок, дедуп по `sha256`.
- Экспорт в XLSX/CSV.

## 4) Что потребует ручной шаг
- OAuth-консоль Gmail (создание client secret).
- Включение IMAP и получение app-password для Mail.ru/Yandex.
- Для некоторых магазинов: ручной экспорт истории заказов (если API нет/закрыт или нет ни каких способов).

## 5) Риски и контроль
- 2FA / app-password: без корректных секретов синхронизация источника пропускается.
- Капча/антибот: direct-web scraping не используется по умолчанию.
- Изменение шаблонов писем: покрыто fallback-парсером + расширяемой системой шаблонов.
- Неустойчивые публичные страницы отзывов: режим `links_only` как безопасный fallback.
